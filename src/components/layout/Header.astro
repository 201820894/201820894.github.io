---
import Search from "@/components/Search.astro";
import ThemeToggle from "@/components/ThemeToggle.astro";
import { menuLinks } from "@/site.config";
import {siteConfig} from "../../site.config";
import { Icon } from "astro-icon/components";

const socialLinks: {
	friendlyName: string;
	isWebmention?: boolean;
	link: string;
	name: string;
}[] = [
	{
		friendlyName: "CV",
		link: "/cv.pdf?v=2",
		name: "mdi:file-document-outline",
	},
	{
		friendlyName: "Github",
		link: "https://github.com/wongyun-yu",
		name: "mdi:github",
	},
	{
		friendlyName: "Google Scholar",
		link: "https://scholar.google.com/citations?user=nWaewr0AAAAJ&hl=en",
		name: "mdi:graduation-cap",
	},
	{
		friendlyName: "X (Twitter)",
		link: "https://x.com/yuwongyun228414/",
		name: "mdi:twitter",
	},
	{
		friendlyName: "LinkedIn",
		link: "https://www.linkedin.com/in/won-gyun-yu-12587b218/",
		name: "mdi:linkedin",
	},

];
---

<header class="group sticky top-0 z-50 mb-10 flex flex-col sm:flex-row sm:items-center bg-global-bg/60 backdrop-blur-md border-b border-gray-200 dark:border-gray-700 pt-8 sm:pt-16 pb-3 -mx-4 px-4 sm:mx-0 sm:px-0 sm:ps-18" id="main-header">
	<div class="flex sm:flex-col">
		<a
			aria-current={Astro.url.pathname === "/" ? "page" : false}
			class="inline-flex items-start hover:opacity-80 transition-opacity sm:relative sm:inline-block"
			href="/"
		>
			<img
				src="/profile.jpg"
				alt="Wongyun Yu Profile"
				class="me-12 h-24 w-24 aspect-square self-start sm:absolute sm:-start-22 sm:-top-4 sm:me-0 sm:h-28 sm:w-28 rounded-full object-cover border-2 border-accent"
			/>
			<span class="text-2xl font-bold sm:text-3xl sm:ml-9 sm:-mt-12 sm:relative sm:-top-2">{siteConfig.title}</span>
		</a>
		<nav
			aria-label="Main menu"
			class="bg-global-bg/95 text-accent sm:divide-accent fixed left-0 right-0 top-32 mx-0 hidden flex-col items-end gap-y-4 rounded-none py-4 px-4 shadow backdrop-blur-md group-[.menu-open]:z-50 group-[.menu-open]:flex sm:static sm:z-auto sm:ms-6 sm:mt-2.5 sm:transform sm:-translate-y-1 sm:flex sm:flex-row sm:items-center sm:divide-x sm:rounded-none sm:bg-transparent sm:py-0 sm:px-0 sm:shadow-none sm:backdrop-blur-none"
			id="navigation-menu"
		>
			{
				menuLinks.map((link) => (
					<a
						aria-current={Astro.url.pathname === link.path ? "page" : false}
						class="px-4 py-4 underline-offset-2 hover:underline sm:py-0"
						data-astro-prefetch
						href={link.path}
					>
						{link.title}
					</a>
				))
			}
		</nav>
		<!-- Social Links below navigation -->
		<div class="hidden sm:flex sm:justify-start sm:ml-9 sm:mt-2 sm:transform sm:translate-y-0.1">
			<ul class="flex items-center gap-x-2">
				{
					socialLinks.map(({ friendlyName, isWebmention, link, name }) => (
						<li class="flex">
							<a
								class="hover:text-link inline-block opacity-70 hover:opacity-100 transition-opacity"
								href={link}
								rel={`noreferrer ${isWebmention ? "me authn" : ""}`}
								target="_blank"
							>
								<Icon aria-hidden="true" class="h-5 w-5 sm:h-6 sm:w-6" focusable="false" name={name} />
								<span class="sr-only">{friendlyName}</span>
							</a>
						</li>
					))
				}
			</ul>
		</div>
	</div>
	<div class="flex items-center gap-x-3 ml-auto">
		<Search />
		<ThemeToggle />
		<!-- Mobile Social Links -->
		<div class="flex items-center gap-x-2 sm:hidden">
			{
				socialLinks.map(({ friendlyName, isWebmention, link, name }) => (
					<a
						class="hover:text-link inline-block opacity-70 hover:opacity-100 transition-opacity"
						href={link}
						rel={`noreferrer ${isWebmention ? "me authn" : ""}`}
						target="_blank"
					>
						<Icon aria-hidden="true" class="h-5 w-5" focusable="false" name={name} />
						<span class="sr-only">{friendlyName}</span>
					</a>
				))
			}
		</div>
				<button
			aria-expanded="false"
			aria-haspopup="menu"
			class="relative ms-4 h-7 w-7 sm:hidden"
			id="toggle-navigation-menu"
			type="button"
		>
			<span class="sr-only">Open main menu</span>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 transition-all"
				fill="none"
				focusable="false"
				id="line-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M3.75 9h16.5m-16.5 6.75h16.5" stroke-linecap="round" stroke-linejoin="round"
				></path>
			</svg>
			<svg
				aria-hidden="true"
				class="absolute start-1/2 top-1/2 h-full w-full -translate-x-1/2 -translate-y-1/2 scale-0 opacity-0 transition-all"
				fill="none"
				focusable="false"
				id="cross-svg"
				stroke="currentColor"
				stroke-width="1.5"
				viewBox="0 0 24 24"
				xmlns="http://www.w3.org/2000/svg"
			>
				<path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round"></path>
			</svg>
		</button>
	</div>
</header>

<script>
	import { toggleClass } from "@/utils/domElement";

	document.addEventListener('DOMContentLoaded', () => {
		const headerEl = document.getElementById("main-header");
		const mobileButtonEl = document.getElementById("toggle-navigation-menu") as HTMLButtonElement;
		const lineSvg = document.getElementById("line-svg");
		const crossSvg = document.getElementById("cross-svg");
		let menuOpen = false;

		if (mobileButtonEl && headerEl && lineSvg && crossSvg) {
			mobileButtonEl.addEventListener("click", () => {
				toggleClass(headerEl, "menu-open");
				menuOpen = !menuOpen;
				mobileButtonEl.setAttribute("aria-expanded", menuOpen.toString());
				
				// Toggle SVG visibility
				if (menuOpen) {
					lineSvg.style.transform = "scale(0)";
					lineSvg.style.opacity = "0";
					crossSvg.style.transform = "scale(1)";
					crossSvg.style.opacity = "1";
				} else {
					lineSvg.style.transform = "scale(1)";
					lineSvg.style.opacity = "1";
					crossSvg.style.transform = "scale(0)";
					crossSvg.style.opacity = "0";
				}
			});
		}
	});
</script>
